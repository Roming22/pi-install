#cloud-config
#
# https://cloudinit.readthedocs.io/
#

hostname: %host.name%

# Update the system
#package_update: true
#package_upgrade: true

users:
- name: %default_user%
  shell: /bin/bash
  ssh-authorized-keys:
    - %default_user.ssh.authorized_keys%
  groups:
    - ubuntu
    - docker
  sudo:
    - ALL=(ALL) NOPASSWD:ALL

packages:
  - curl

runcmd:
  - /root/install/docker.sh
  - /root/install/k3d.sh
  - kubectl completion bash >/etc/bash_completion.d/kubectl
  - kubectl get all --all-namespaces
  - rm -rf /root/install

# Reboot after first boot
power_state:
  delay: "now"
  message: Device is configured and up to date. Rebooting...
  mode: reboot
